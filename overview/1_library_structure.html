

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>The structure of Stytra &mdash; Stytra 0.8.33 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Stimulation" href="2_stimulation_intro.html" />
    <link rel="prev" title="Introduction" href="0_motivation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #4987a7" >
          

          
            <a href="../index.html" class="icon icon-home"> Stytra
          

          
            
            <img src="../_static/logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.8.32
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Overview</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="0_motivation.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">The structure of Stytra</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#basic-classes">Basic classes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="2_stimulation_intro.html">Stimulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_tracking.html">Image acquisition and tracking</a></li>
<li class="toctree-l1"><a class="reference internal" href="4_closed_loop.html">Closed-loop stimuli design</a></li>
<li class="toctree-l1"><a class="reference internal" href="5_external_sync.html">Synchronizing stimulation with data acquisition</a></li>
<li class="toctree-l1"><a class="reference internal" href="6_hardware_list.html">Hardware description</a></li>
<li class="toctree-l1"><a class="reference internal" href="7_comparison.html">Comparison with existing software and limitations</a></li>
<li class="toctree-l1"><a class="reference internal" href="8_replication.html">Experiment replication</a></li>
<li class="toctree-l1"><a class="reference internal" href="9_references.html">References</a></li>
</ul>
<p class="caption"><span class="caption-text">User guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userguide/0_install_guide.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/1_examples_gallery.html">Designing and running experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/2_interface.html">User interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/3_tracking.html">Tracking configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/4_calibration.html">Calibration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/5_configuring_computer.html">Configuring a computer for Stytra experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/6_coordinate_systems.html">Coordinate systems in Stytra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/7_offline.html">Offline use of Stytra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/8_faqs.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../devdocs/0_module_desc.html">Module description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devdocs/1_pipelines.html">Implementation of image processing pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devdocs/2_triggering_intro.html">Triggering a Stytra protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devdocs/3_data_saving.html">Data and metadata saving</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devdocs/4_parameters_stytra.html">Parameters in stytra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devdocs/5_status_messages.html">Process status messages</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Stytra</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>The structure of Stytra</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/overview/1_library_structure.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-structure-of-stytra">
<span id="sytra-struct"></span><h1>The structure of Stytra<a class="headerlink" href="#the-structure-of-stytra" title="Permalink to this headline">¶</a></h1>
<p>We developed Stytra using the Python programming language. We endeavored to follow best practices in software engineering: separation of user interface and data processing code, modularity and consistent programming interfaces.</p>
<p>In Stytra, new experiments can be designed using very simple Python syntax, allowing even beginners in programming to develop their own stimulation paradigms. Once defined, the experiment is controlled through a graphical user interface which can be used with no knowledge of Python.</p>
<p>At the core of the Stytra package lies the <code class="xref py py-class docutils literal notranslate"><span class="pre">Experiment</span></code> object, which links all components that may be used in an experiment: stimulus presentation, camera, animal tracking, metadata and logging. This organization enables composing different experimental paradigms with full code reuse. Improvement of different modules (e.g. the user interface, plotting or tracking) is therefore reflected in all experimental setups, and support for a new piece of hardware or tracking function can be added with minimal effort and interference
with other parts of the project. Online image processing is organized along
a sequence of steps: first, images are acquired from the camera, then the image is filtered and tracked, and the tracking results are saved. Acquisition, tracking and data saving occur in separate processes (depicted in blue, purple, and green in the diagram below).</p>
<a class="reference internal image-reference" href="../_images/data_flow.svg"><img alt="dataflow diagram" class="align-center" src="../_images/data_flow.svg" width="540px" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>This approach improves the reliability and the performance of online behavioral tracking, and exploits the advantages of multi-core processors. After processing, streaming numerical data (such as tracking results and dynamic parameters of stimuli) is passed into data accumulators in the main thread, and a user-selected subset can be plotted in real time and saved in one of the several supported formats. Moreover, for every experimental session all changeable properties impacting the execution of the experiment are recorded and saved. Finally, as the software package is version-controlled, the version (commit hash) of the software in use is saved as well, ensuring the complete reproducibility of every experiment.</p>
<img alt="dataflow class diagram" class="align-center" id="dataflow-block" src="../_images/dataflow_classes.svg" /><div class="section" id="basic-classes">
<h2>Basic classes<a class="headerlink" href="#basic-classes" title="Permalink to this headline">¶</a></h2>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">Experiment</span></code> object binds all the different components required to run an experiment. The most basic <code class="xref py py-class docutils literal notranslate"><span class="pre">Experiment</span></code> object performs the presentation of a succession of stimuli, saving the experiment metadata and the stimulation log. For experiments including video tracking, the <code class="xref py py-class docutils literal notranslate"><span class="pre">TrackingExperiment</span></code> object augments the basic <code class="xref py py-class docutils literal notranslate"><span class="pre">Experiment</span></code> with features such as camera frame acquisitions and online image analysis. The image analysis pipeline can be one of the zebrafish specific pipelines supplied with Stytra, or a custom tracking pipeline. The <code class="xref py py-class docutils literal notranslate"><span class="pre">Experiment</span></code> is linked to the  user interface for controlling the running of stimulation protocols, inserting metadata, controlling parameters, and calibrating the stimulus display. For details of the user interface, please see the <a class="reference internal" href="../userguide/2_interface.html#gui-desc"><span class="std std-ref">user interface</span></a> section of the documentation.</p>
<p>In general, the users do not need to define new types of <code class="xref py py-class docutils literal notranslate"><span class="pre">Experiment</span></code> objects for every new experimental paradigm. Instead, paradigms are implemented by defining a <code class="xref py py-class docutils literal notranslate"><span class="pre">Protocol</span></code>  object which contains the stimulus sequence (as described below) and a configuration dictionary with information about the camera, tracking pipeline, and triggering. The appropriate <code class="xref py py-class docutils literal notranslate"><span class="pre">Experiment</span></code>  object can be automatically instantiated from the configuration dictionary using the Stytra constructor. Alternatively, an <code class="xref py py-class docutils literal notranslate"><span class="pre">Experiment</span></code>  can be instantiated and run from the experiment script, as described in the documentation examples. Ideally, the provided <code class="xref py py-class docutils literal notranslate"><span class="pre">Experiment</span></code>  objects should cover most of the requirements of zebrafish behavioral experiments, and  redefining the <code class="xref py py-class docutils literal notranslate"><span class="pre">Experiment</span></code>  is required only if one needs to modify the  graphical user interface (GUI), add more nodes in the data pipeline (screens or cameras) or implement more specific customizations. A more detailed depiction of the connections and versions of different objects is depicted in above.  For examples of how to create a <code class="xref py py-class docutils literal notranslate"><span class="pre">Protocol</span></code>  and run experiments in Stytra, see <a class="reference internal" href="../userguide/1_examples_gallery.html#protocol-definition"><span class="std std-ref">Create a new protocol</span></a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="2_stimulation_intro.html" class="btn btn-neutral float-right" title="Stimulation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="0_motivation.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Vilim Štih and Luigi Petrucco, @portugueslab

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>